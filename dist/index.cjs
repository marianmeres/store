"use strict";const e=e=>"function"==typeof e,r=(r,t="")=>{if(!e(r))throw new TypeError(`${t} Expecting function arg`.trim())},t=r=>e(r.subscribe),s=(t=undefined,s=null)=>{const n=r=>e(s?.persist)&&s.persist(r);let c=(()=>{const e=new Map,r=r=>(e.has(r)||e.set(r,new Set),e.get(r)),t=(e,t)=>{if("function"!=typeof t)throw new TypeError("Expecting callback function as second argument");return r(e).add(t),()=>r(e).delete(t)};return{publish:(e,t={})=>{r(e).forEach((e=>e(t)))},subscribe:t,subscribeOnce:(e,r)=>{const s=t(e,(e=>{r(e),s()}));return s},unsubscribeAll:r=>e.delete(r)}})(),i=t;n(i);const o=()=>i,u=e=>{i!==e&&(i=e,n(i),c.publish("change",i))};return{set:u,get:o,update:e=>{r(e,"[update]"),u(e(o()))},subscribe:e=>(r(e,"[subscribe]"),e(i),c.subscribe("change",e))}};exports.createDerivedStore=(n,c,i=null)=>{const o=s(i?.initialValue),u=[];n.forEach((e=>{if(!t(e))throw new TypeError("Expecting array of StoreLike objects");u.push(e.get())}));let b=0,a=[];const p=()=>{b++||n.forEach(((r,t)=>{a.push(r.subscribe((r=>{var s;u[t]=r,o.set(c(u)),s=o.get(),e(i?.persist)&&i.persist(s)})))}))};return{get:o.get,subscribe:e=>{r(e,"[derived.subscribe]"),p();const t=o.subscribe(e);return()=>{--b||(a.forEach((e=>e())),a=[]),t()}}}},exports.createStore=s,exports.isStoreLike=t;
